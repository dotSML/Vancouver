@page
@model IndexModel
    @{
        ViewData["Title"] = "Vancouver Flights";
    }


<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script src="~/js/datepicker/dist/datepicker.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js"></script>
    <link href="~/css/airportAC.css" rel="stylesheet" />
    <link href="~/css/bootstrapIndex.css" rel="stylesheet" />
    <link href="~/js/datepicker/dist/datepicker.css" rel="stylesheet" />
    
</head>
<body>
<div class="vertical-center">
    <div autocomplete="off">
        <div class="row align-items-center" style="margin-top: 250px; background-color: rgba(0, 0, 0, 0.3); border-radius: 7px; padding-top: 3px; padding-bottom: 3px;">
        <div class="col-auto" style="padding-left: 8px">
            <label class="sr-only" for="autocompleteDepart">Departure</label>
            <input type="text" name="departureField" class="form-control js_airports_auto_complete" id="autocompleteDepart" placeholder="Departure">
        </div>
        <div class="col-auto">
            <label class="sr-only" for="autocompleteArrive">Arrival</label>
            <input type="text" name="arrivalField" class="form-control js_airports_auto_complete" id="autocompleteArrive" placeholder="Arrival">
        </div>
        <div class="col-auto">
            <label class="sr-only" for="datepickerOutbound">Outbound</label>
            <input type="text" name="outboundDate" class="form-control" data-toggle="datepicker" id="datepickerOutbound" placeholder="Outbound">
        </div>
        <div class="col-auto">
            <label class="sr-only" for="datepickerInbound">Inbound</label>
            <input type="text" name="inboundDate" class="form-control" data-toggle="datepicker" id="datepickerInbound" placeholder="Inbound">
        </div>
            <div class="col-auto" style="margin-left: 25px" id="searchFlights">
                <button class="btn btn-primary" id="testBtn">Search</button>
            </div>
        </div>
        
        <div class="row align-items-center" style="background-color: rgba(0, 0, 0, 0.3); border-radius: 7px">
            <div class="col-auto" style="margin: 1px">
                <select class="form-control" id="passengers">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                </select>
            </div>
        </div>       
    </div>
   </div> 
    

<div id="flightResults" class="vertical-center" style="margin-top: 25px;">
    <div class="container" style="background-color: rgba(0, 0, 0, 0.8); border-radius: 7px;">
        <div class="row" style="color: white;">
            <div id="flightInfoAirline" class="col-2 align-self-center"></div>
            <div class="col-1 align-self-center"><span id="flightInfoDepartureTime"></span><br/><span id="flightInfoOriginAirport"></span></div>
            <div class="col-1 align-self-center">
                <div id="flightInfoDuration" style="font-size: 13px"></div>
                <div style="font-size: 10px;"><span id="flightInfoLayovers" style="color: red;"></span>
                    <div id="fligthInfoLayoverCities"></div>
                </div>
            </div>
            <div class="col-1 align-self-center"><span id="flightInfoArrivalTime"></span><br/><span id="flightInfoArrivalAirport"></span>
                <span id="flightInfoArrivalAirport"></span>
            </div>
            <div class="col-1 align-self-center"><span id="flightInfoPriceSpan" style="color:green"></span></div>
        </div>
        
    </div>
</div>

<div id="loading"><h1 style="color:white">LOADING</h1></div>

@*<div class="btn btn-primary" id="testBtn">Check values</div>*@
<script>
    $(document).ready(function() {
        $('#loading').hide();
        $('#flightResults').hide();
    })
</script>

<script>
    $('#testBtn').on("click", function() {

        $('#loading').show();

        var apiKey = "DAI4hfrkFliQkgA6U4L04yImEuD9g06i";
        var origin = $('#autocompleteDepart').val();
        var destination = $('#autocompleteArrive').val();
        var outboundDate = $('#datepickerOutbound').val();
        outboundDate = outboundDate.replace(/\//g, "-");
        outboundDate = outboundDate.split('-');
        outboundDate = outboundDate[2] + '-' + outboundDate[0] + '-' + outboundDate[1];
        var inboundDate = $('#datepickerInbound').val();
        inboundDate = inboundDate.replace(/\//g, "-");
        inboundDate = inboundDate.split("-");
        inboundDate = inboundDate[2] + '-' + inboundDate[0] + '-' + inboundDate[1];
        var adultPassengers = $('#passengers').val();
        var url =
            "https://api.sandbox.amadeus.com/v1.2/flights/low-fare-search?apikey=" +
                apiKey +
                "&origin=" +
                origin +
                "&destination=" +
                destination +
                "&departure_date=" +
                outboundDate +
                "&return_date=" +
                inboundDate +
                "&adults=" +
                adultPassengers;

        console.log(apiKey, origin, destination, outboundDate, inboundDate, adultPassengers, url);

        $.ajax({
            dataType: "json",
            url:
                "https://api.sandbox.amadeus.com/v1.2/flights/low-fare-search?apikey=" +
                    apiKey +
                    "&origin=" +
                    origin +
                    "&destination=" +
                    destination +
                    "&departure_date=" +
                    outboundDate +
                    "&return_date=" +
                    inboundDate +
                    "&adults=" +
                    adultPassengers,

            success:
                function (faresData) {
                    $('#loading').hide();
                    $('#flightResults').show();
                    var getArrivalAirport = faresData.results[0]['itineraries'][0]['outbound']['flights'].length - 1;
                    var departureTime =
                        faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['departs_at'].split('T')[1];
                    var arrivalTime = faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['arrives_at'].split('T')[1];
                    var layoverCities;
                    var i;
                    
                    console.log(faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['departs_at']);
                    console.log(faresData.results[0]['itineraries'][0]['outbound']['flights'][1]['departs_at']);
                    console.log(layoverCities);
                    console.log(faresData.results[0]);
                    console.log(faresData.results[0]['fare']['total_price']);
                    console.log(faresData.results[0]['itineraries'][0]['inbound']);
                    console.log(faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['origin']['airport']);
                    console.log(departureTime);
                    $('#flightInfoPriceSpan').text(faresData.results[0]['fare']['total_price']  + "$");
                    $('#flightInfoOriginAirport').text(faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['origin']['airport']);
                    $('#flightInfoArrivalAirport').text(faresData.results[0]['itineraries'][0]['outbound']['flights'][getArrivalAirport]['destination']['airport']);
                    $('#flightInfoDepartureTime').text(departureTime);
                    $('#flightInfoDuration').text(faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['duration']);
                    $('#flightInfoLayovers')
                        .text(faresData.results[0]['itineraries'][0]['outbound']['flights'].length - 1 + "stop(s)");
                    $('#flightInfoArrivalTime').text(arrivalTime);
                    //$('#flightInfoLayoverCities').text(layoverCities[1,2,3]);
                    $('#flightInfoAirline').text(faresData.results[0]['itineraries'][0]['outbound']['flights'][0]['marketing_airline']);
                }

        });

    });
</script>






<script src="~/js/datepicker/flightDatepicker.js"></script>
<script src="~/js/airportsAutoComplete.js"></script>
</body>
</html>





